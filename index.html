<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>reveal.js</title>

    <link rel="stylesheet" href="node_modules/reveal.js/dist/reset.css">
    <link rel="stylesheet" href="node_modules/reveal.js/dist/reveal.css">
    <link rel="stylesheet" href="node_modules/reveal.js/dist/theme/black.css">

    <!-- Theme used for syntax highlighted code -->
    <link rel="stylesheet" href="node_modules/reveal.js/plugin/highlight/monokai.css">
</head>

<body>
    <div class="reveal">
        <div class="slides">
            <section>
                <a href="https://revealjs.com">
                    <img src="https://static.slid.es/reveal/logo-v1/reveal-white-text.svg" alt="reveal.js logo"
                        style="height: 180px; margin: 0 auto 4rem auto; background: transparent;" class="demo-logo">
                </a>
                <h3>Clean Architecture</h3>
                <p>
                    <small>Présenté par <a href="http://hakim.se">Maël Sicard-Cras</a></small>
                </p>
            </section>

            <section data-transition="slide" data-background="#4d7e65" data-background-transition="zoom">
                <h2>Introduction</h2>
                <p class="fragment">Qui suis-je?</p>
                <p class="fragment">Qui êtes vous?</p>
                <p><span class="fragment">Vous & la Clean Architecture?</span></p>
            </section>

            <section>
                <section data-background="#dddddd">
                    <h2>Quels sont les obstacles typiques pour les développeurs ?</h2>
                </section>
                <section data-background="#dddddd">
                    <h2>Changement de Technologie</h2>
                    <p>Mysql vs MariaDB, Mongo vs DocumentDB, ...</p>
                </section>
                <section data-background="#dddddd">
                    <h2>Breaking changes</h2>
                    <p>Change une table SQL et la réponse de l'API change, ...</p>
                </section>
                <section data-background="#dddddd">
                    <h2>Code peu clair</h2>
                    <p>Logique métier mélangée avec le reste du code, ...</p>
                </section>
                <section data-background="#dddddd">
                    <h2>Code non testable</h2>
                    <p>Logique métier non testée, difficile d'identifier quoi tester, ...</p>
                </section>
                <section data-background="#dddddd">
                    <h2>Qualité peu élevée</h2>
                    <p>Dûr de s'y retrouver dans le code, chaque dévelopeur code à sa manière, ...</p>
                </section>
            </section>

            <section>
                <p>Alors parlons de ...</p>
                <h2 class="r-fit-text">CLEAN ARCHITECTURE</h2>
            </section>

            <section>
                <section data-background="#717286">
                    <h2>La théorie</h2>
                </section>
                <section data-background="#717286">
                    <h2>Le Domain Driven Design</h2>
                    <img class="r-frame" style="border: none;" width="40%" data-src="/assets/images/DDD.png" alt="ddd">
                </section>
                <section data-background="#717286">
                    <h2>L'architecture héxagonale</h2>
                    <img class="r-frame" width="85%" data-src="/assets/images/hex.jpeg" alt="hex">
                </section>
                <section data-background="#717286">
                    <h2>Les strates de la Clean Architecture</h2>
                    <img class="r-frame" width="60%" data-src="/assets/images/CleanArchitectureCone.jpg" alt="hex">
                </section>
                <section data-background="#717286">
                    <h2>Dependency Rule</h2>
                    <img class="r-frame" width="65%" data-src="/assets/images/CleanArchitecture.jpg" alt="ca">
                </section>
            </section>

            <section>
                <section data-background="#C0C0C0">
                    <h2>La pratique</h2>
                </section>
                <section data-background="#C0C0C0">
                    <h2>Notre code</h2>
                    <pre data-id="code-animation">
                        <code class="hljs javascript" data-trim data-line-numbers style="width: 140%; margin-left: -20%;">
                            const fastify = require('fastify')({ logger: true })

                            fastify.get('/api/v1/dogs', async (request, reply) => {
                                return await orm.getRepository(DogFact).find();
                            })
                            
                            fastify.get('/api/v1/dogs/:factId', async (request, reply) => {
                                return await orm.getRepository(DogFact).findOne(request.params.factId);
                            })

                            const start = async () => {
                                await fastify.listen({ port: 3000 })
                            }
                            start()
                        </code>
                    </pre>
                </section>

                <section data-background="#C0C0C0">
                    <h2>Le Domain Driven Design</h2>
                    <img class="r-frame" style="border: none;" width="40%" data-src="/assets/images/DDD.png" alt="ddd">
                </section>
                <section data-background="#C0C0C0">
                    <h2>Le Domain Driven Design</h2>
                    <pre data-id="code-animation">
                        <code class="hljs javascript" data-trim data-line-numbers style="width: 140%; margin-left: -20%;">
                            const fastify = require('fastify')({ logger: true })

                            interface DogFactEntity {
                                factId: number;
                                fact: string;
                            }

                            async getAllDogFacts(): Promise&lt;DogFactEntity[]&gt; {
                                return await orm.getRepository(DogFact).find();
                            }
                            
                            async getDogFactById(factId: number): Promise&lt;DogFactEntity&gt; {
                                return await orm.getRepository(DogFact).findOne(factId);
                            }

                            fastify.get('/api/v1/dogs', async (request, reply) => {
                                return await getAllDogFacts()
                            })
                            
                            fastify.get('/api/v1/dogs/:factId', async (request, reply) => {
                                return await getDogFactById(request.params.factId)
                            })

                            const start = async () => {
                                await fastify.listen({ port: 3000 })
                            }
                            start()
                        </code>
                    </pre>
                </section>

                <section data-background="#717286">
                    <h2>L'architecture héxagonale</h2>
                    <img class="r-frame" width="85%" data-src="/assets/images/hex.jpeg" alt="hex">
                </section>
                <section data-background="#717286">
                    <h2>L'architecture héxagonale</h2>
                    <pre data-id="code-animation">
                        <code class="hljs javascript" data-trim data-line-numbers style="width: 140%; margin-left: -20%;">
                            const fastify = require('fastify')({ logger: true })

                            // Domain
                            interface DogFactEntity {
                                factId: number;
                                fact: string;
                            }

                            // SPI (API <---> Internal Database)
                            async getAllDogFacts(): Promise&lt;DogFactEntity[]&gt; {
                                return await orm.getRepository(DogFact).find();
                            }
                            
                            async getDogFactById(factId: number): Promise&lt;DogFactEntity&gt; {
                                return await orm.getRepository(DogFact).findOne(factId);
                            }

                            // API (Clients <---> API)
                            fastify.get('/api/v1/dogs', async (request, reply) => {
                                return await getAllDogFacts()
                            })
                            
                            fastify.get('/api/v1/dogs/:factId', async (request, reply) => {
                                return await getDogFactById(request.params.factId)
                            })

                            const start = async () => {
                                await fastify.listen({ port: 3000 })
                            }
                            start()
                        </code>
                    </pre>
                </section>

                <section data-background="#C0C0C0">
                    <h2>Les strates de la Clean Architecture</h2>
                    <img class="r-frame" width="60%" data-src="/assets/images/CleanArchitectureCone.jpg" alt="hex">
                </section>
                <section data-background="#C0C0C0">
                    <h2>Les strates de la Clean Architecture</h2>
                    <pre data-id="code-animation">
                        <code class="hljs javascript" data-trim data-line-numbers style="width: 140%; margin-left: -20%;">
                            // 1 - EXTERNAL INTERFACES: src/infrastructure/app.ts
                            const fastify = require('fastify')({ logger: true })

                            const start = async () => {
                                await fastify.listen({ port: 3000 })
                            }
                            start()
                            
                            // 2 - ADAPTER (SPI): src/adapter/spi/db/repository.ts
                            async getAllDogFacts(): Promise&lt;DogFactEntity[]&gt; {
                                return await orm.getRepository(DogFact).findOne(factId);
                            }
                            
                            async getDogFactById(factId: number): Promise&lt;DogFactEntity&gt; {
                                return await orm.getRepository(DogFact).find();
                            }

                            // 2 - ADAPTER (API): src/adapter/api/controller.ts
                            fastify.get('/api/v1/dogs', async (request, reply) => {
                                return await new GetAllDogFactsUseCase().execute()
                            })
                            
                            fastify.get('/api/v1/dogs/:factId', async (request, reply) => {
                                return await new GetOneDogFactByIdUseCase(request.params.factId).execute()
                            })

                            // 3 - USE CASES: src/application/usecases/getAllDogFactsUseCase.ts
                            class GetAllDogFactsUseCase{
                                async execute(): Promise&lt;DogFactEntity[]&gt; {
                                    return await repository.getAllDogFacts();
                                }
                            }

                            // 3 - USE CASES: src/application/usecases/GetOneDogFactByIdUseCase.ts
                            class GetOneDogFactByIdUseCase{
                                async execute(): Promise&lt;DogFactEntity&gt; {
                                    return await repository.getDogFactById(factId);
                                }
                            }
                            
                            // 4 - ENTITIES: src/domain/entities.ts
                            interface DogFactEntity {
                                factId: number;
                                fact: string;
                            }
                        </code>
                    </pre>
                </section>

                <section data-background="#C0C0C0">
                    <h2>Dependency Rule</h2>
                    <img class="r-frame" width="65%" data-src="/assets/images/CleanArchitecture.jpg" alt="ca">
                </section>
                <section data-background="#C0C0C0">
                    <h2>Dependency Rule incorrecte</h2>
                    <pre data-id="code-animation">
                        <code class="hljs javascript" data-line-numbers="|1-3|7|10" data-trim data-line-numbers style="width: 140%; margin-left: -20%;">
                            //current path: src/application/usecases/GetOneDogFactByIdUseCase.ts
                            
                            import {DogFactsRepository} from "src/adapter/spi/db/dog_facts_repository";
                            import {DogFactEntity} from "src/domain/entities/dog_fact_entity";

                            export class GetAllDogFactsUseCase {
                                private repository: DogFactsRepository;
                            
                                constructor() {
                                    this.repository = new DogFactsRepository();
                                }
                            
                                async execute(): Promise&lt;DogFactEntity[]&gt; {
                                    return await this.repository.getAllDogFacts();
                                }
                            }
                        </code>
                    </pre>
                </section>
                <section data-background="#C0C0C0">
                    <h2>Dependency Rule correcte</h2>
                    <pre data-id="code-animation">
                        <code class="hljs javascript" data-line-numbers="|1-3|7|9" data-trim data-line-numbers style="width: 140%; margin-left: -20%;">
                            //current path: src/application/usecases/GetOneDogFactByIdUseCase.ts
                            
                            import {DogFactsRepositoryInterface} from "src/application/repositories/dog_facts_repository_interface";
                            import {DogFactEntity} from "src/domain/entities/dog_fact_entity";

                            export class GetAllDogFactsUseCase {
                                private repository: DogFactsRepositoryInterface;
                            
                                constructor(repository: DogFactsRepositoryInterface) {
                                    this.repository = repository;
                                }
                            
                                async execute(): Promise&lt;DogFactEntity[]&gt; {
                                    return await this.repository.getAllDogFacts();
                                }
                            }
                        </code>
                    </pre>
                </section>
            </section>

            <section>
                <section data-background="#737373">
                    <h2>Demo</h2>
                </section>
                <section data-background="#737373">
                    <h2>Cats & Dogs Facts API</h2>
                    <ul>
                        <li class="fragment">API de faits divers sur les animaux</li>
                        <li class="fragment">2 endpoints par animal (tous ou certains faits)</li>
                        <li class="fragment">Structure JSON différentes entre animaux</li>
                        <li class="fragment">Données lues depuis la DB et API externe</li>
                    </ul>
                </section>
                <section data-background="#737373">
                    <h2>Github</h2>

                    https://github.com/MSC29
                    <br />
                    <br />
                    <ul>
                        <li>clean-architecture-typescript</li>
                        <li>clean-architecture-python</li>
                        <li>clean-architecture-rust</li>
                        <li>clean-architecture-go</li>
                    </ul>
                </section>
                <section data-background="#717286">
                    <h2>Hexagonal Architecture</h2>
                    <img data-src="/assets/images/hex.drawio.png" alt="hex_api">
                </section>
                <section data-background="#717286">
                    <h2>Data flow</h2>
                    <img width="120%" style="max-width: 120%; margin-left: -10%"
                        data-src="/assets/images/lifecycle2.png" alt="lifecycle2">
                </section>
            </section>

            <section>
                <section data-background="#4C4C4C">
                    <h2>Cas pratique</h2>
                </section>
                <section data-background="#737373">
                    <h2>Décision managériale!!!</h2>
                    <ul>
                        <li class="fragment">Pas d'investissement dans le cloud...</li>
                        <li class="fragment">On préfère maintenir une DB en local</li>
                        <li class="fragment">On migre le service HTTP & les données</li>
                        <li class="fragment">Nos clients ne doivent pas s'en rendre compte</li>
                    </ul>
                </section>
                <section data-background="#C0C0C0">
                    <h2>Notre code</h2>
                    <pre data-id="code-animation">
                        <code class="hljs javascript" data-line-numbers="4,8" data-trim data-line-numbers style="width: 140%; margin-left: -20%;">
                            const fastify = require('fastify')({ logger: true })

                            fastify.get('/api/v1/cats', async (request, reply) => {
                                return await http.get(`${api}/facts`);
                            })
                            
                            fastify.get('/api/v1/cats/:factId', async (request, reply) => {
                                return await http.get(`${api}/fact/${request.params.factId}`);
                            })

                            const start = async () => {
                                await fastify.listen({ port: 3000 })
                            }
                            start()
                        </code>
                    </pre>
                </section>
                <section data-background="#4C4C4C">
                    <p><a href="https://github.com/MSC29/clean-architecture-typescript/pull/4/files">PR</a></p>
                    <p>Video Typescript</p>
                    <p>Video Python</p>
                </section>
            </section>

            <section>
                <section data-background="#4C4C4C">
                    <h2>Conclusion</h2>
                </section>
                <section data-background="#4C4C4C">
                    <h2>Résumé</h2>
                    <ul>
                        <li class="fragment">Domain driven design</li>
                        <li class="fragment">Hexagonal architecture</li>
                        <li class="fragment">Dependency rule</li>
                        <li class="fragment">Dependency injection</li>
                    </ul>
                </section>
                <section data-background="#4C4C4C">
                    <h2>Pros (& cons)</h2>
                    <ul>
                        <li class="fragment">Isolation des domaines & logiques métier</li>
                        <li class="fragment">Simple et peu couteux de changer de technologie</li>
                        <li class="fragment">Reste flexible & scalable sur des gros projets</li>
                        <li class="fragment">Aisance de test</li>
                    </ul>
                </section>
            </section>

            <section>
                <section data-background="#4C4C4C">
                    <h2>Merci</h2>
                </section>
            </section>

            <section>
                <section data-background="#4C4C4C">
                    <h2>Q&A</h2>
                </section>
            </section>
        </div>
    </div>

    <script src="node_modules/reveal.js/dist/reveal.js"></script>
    <script src="node_modules/reveal.js/plugin/notes/notes.js"></script>
    <script src="node_modules/reveal.js/plugin/markdown/markdown.js"></script>
    <script src="node_modules/reveal.js/plugin/highlight/highlight.js"></script>
    <script>
        // More info about initialization & config:
        // - https://revealjs.com/initialization/
        // - https://revealjs.com/config/
        Reveal.initialize({
            hash: true,

            // Learn about plugins: https://revealjs.com/plugins/
            plugins: [RevealMarkdown, RevealHighlight, RevealNotes]
        });
    </script>
</body>

</html>